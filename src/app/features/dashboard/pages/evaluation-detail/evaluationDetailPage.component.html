<div class="card evaluation-detail-card">
  <h2 class="form-title" *ngIf="evaluacion?.modality === 'CNN'">
    Evaluación por Resonancia Magnética
  </h2>
  <h2 class="form-title" *ngIf="evaluacion?.modality === 'RF'">
    Evaluación por Datos Clínicos
  </h2>
  <div class="patient-info" *ngIf="patient">
    <b>Paciente:</b> {{ patient.name + " " + patient.last_name }}<br />
    <b>DNI:</b> {{ patient.dni }}<br />
  </div>

  <div class="main-actions" *ngIf="evaluacion && evaluacion.modality == 'CNN'">
    <button class="btn" (click)="ejecutarModelo()" *ngIf="evaluacion">
      Ejecutar Detección
    </button>
    <button class="btn primary" (click)="guardarTodo()" [disabled]="loading">
      Guardar
    </button>
    <button class="btn secondary" (click)="salir()">Salir</button>
  </div>

  <ng-container *ngIf="evaluacion?.modality === 'CNN'">
    <h3 class="section-title">Imagen MRI</h3>
    <input class="input" type="file" (change)="cargarImagen($event)" />
    <div *ngIf="imagenUrl" class="mri-image-large">
      <img [src]="imagenUrl" class="mri-img-large" />
    </div>
    <div
      *ngIf="evaluacion.model_classification && evaluacion.model_probability"
      class="model-result"
    >
      <h4>Detección</h4>
      <p><b>Resultado:</b> {{ mapresult(evaluacion) }}</p>
      <p><b>Probabilidad:</b> {{ evaluacion.model_probability | percent }}</p>
    </div>
  </ng-container>

  <ng-container *ngIf="evaluacion?.modality === 'RF'">
    <h3 class="section-title">Datos Clínicos</h3>
    <form [formGroup]="clinicForm" class="form-section clinic-form">
      <p class="form-helper">
        Sub-componentes del CDR (Clinical Dementia Rating). Seleccione un valor entre 0 y 3.
      </p>
      <ng-container *ngFor="let component of cdrSubComponents">
        <label>
          {{ component.label }}
          <strong>(0-3)</strong>
        </label>
        <select class="input" [formControlName]="component.control">
          <option [ngValue]="null" disabled>
            Seleccione la valoración
          </option>
          <option
            *ngFor="let option of cdrScoreOptions"
            [ngValue]="option.value"
          >
            {{ option.label }}
          </option>
        </select>
      </ng-container>
    </form>
    <div class="main-actions" *ngIf="evaluacion && evaluacion.modality == 'RF'">
      <button class="btn" (click)="ejecutarModelo()" *ngIf="evaluacion">
        Ejecutar Detección
      </button>
      <button class="btn primary" (click)="guardarTodo()" [disabled]="loading">
        Guardar
      </button>
      <button class="btn secondary" (click)="salir()">Salir</button>
    </div>
    <div
      *ngIf="evaluacion.model_classification && evaluacion.model_probability"
      class="model-result"
    >
      <h4>Detección</h4>
      <p><b>Resultado:</b> {{ mapresult(evaluacion) }}</p>
      <p><b>Probabilidad:</b> {{ evaluacion.model_probability | percent }}</p>
    </div>
  </ng-container>
  <div *ngIf="evaluacion && evaluacion.model_classification != null">
    <div class="form-section manual-classification-form">
      <h3 class="section-title">Observación</h3>
      <form [formGroup]="manualForm">
        <select
          class="input"
          formControlName="manual_classification"
          *ngIf="evaluacion.modality === 'RF'"
        >
          <option value="" disabled selected>Seleccione su observación</option>
          <option [ngValue]="null">Ninguna</option>
          <option value="Normal">Normal</option>
          <option value="DEMENTIA">Demencia</option>
        </select>
        <select
          class="input"
          formControlName="manual_classification"
          *ngIf="evaluacion.modality === 'CNN'"
        >
          <option value="" disabled selected>Selecciona su observación</option>
          <option [ngValue]="null">Ninguna</option>

          <option value="Normal">Normal</option>
          <option value="Mild Dementia">Demencia Leve</option>
          <option value="Moderate Dementia">Demencia Moderada</option>
          <option value="Severe Dementia">Demencia Severa</option>
        </select>
      </form>
    </div>
    <div class="form-section nota-form">
      <h3 class="section-title">Detalle de la Observacion</h3>
      <form [formGroup]="notaForm">
        <textarea
          class="input"
          formControlName="description"
          placeholder="Segun su observación, detalle la evaluación..."
        ></textarea>
      </form>
    </div>
  </div>
</div>
